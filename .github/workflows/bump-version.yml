name: Auto Bump Version

on:
  push:
    branches: [ main ]

jobs:
  bump:
    # Prevent running the job when the push was made by the GitHub Actions bot itself
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Prepare package.json as ES module (so bump script can use import)
        run: |
          npm init -y
          # Add "type":"module" to package.json so import syntax works
          node -e "const fs=require('fs');const p=JSON.parse(fs.readFileSync('package.json'));p.type='module';fs.writeFileSync('package.json', JSON.stringify(p,null,2));console.log('package.json updated to type=module')"

      - name: Run version bump script
        run: |
          node bump-version.js

      - name: Show git status
        run: git --no-pager log -3 --oneline || true
